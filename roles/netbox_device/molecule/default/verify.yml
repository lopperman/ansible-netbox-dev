---
- name: Verify
  hosts: all
  gather_facts: false

  tasks:
    - name: Check if device info file was created
      ansible.builtin.stat:
        path: /tmp/molecule-test-device.txt
      register: device_file

    - name: Verify device file exists
      ansible.builtin.assert:
        that:
          - device_file.stat.exists
        fail_msg: "Device info file was not created"
        success_msg: "Device info file exists as expected"

    - name: Read device file content
      ansible.builtin.slurp:
        src: /tmp/molecule-test-device.txt
      register: device_content

    - name: Display device content
      ansible.builtin.debug:
        msg: "{{ device_content['content'] | b64decode }}"

    - name: Verify device content
      ansible.builtin.assert:
        that:
          - "'molecule-test-device' in (device_content['content'] | b64decode)"
          - "'test-server' in (device_content['content'] | b64decode)"
        fail_msg: "Device content doesn't match expected values"
        success_msg: "Device content is correct"
